{% extends 'base.html' %}
{% load crispy_forms_tags %}
{% load widget_tweaks %}

{% block content %}
<div class="container py-4" style="background: #f8f9fa;">
  <div class="row justify-content-center">
    <div class="col-md-8">
      <div class="card shadow-sm border-0" style="border-radius: 15px; background-color: #ffffff;">
        <div class="card-body p-4">
          <h2 class="text-center mb-4" style="font-weight: 600; color: #333;">{{ is_update|yesno:"Update Competition,Create Competition" }}</h2>
          <form method="post" enctype="multipart/form-data" class="needs-validation" novalidate>
            {% csrf_token %}

            <div class="row g-3">
              <div class="col-md-6">
                {{ form.name|as_crispy_field }}
              </div>
              <div class="col-md-6">
                {{ form.event_location_name|as_crispy_field }}
              </div>
              <div class="col-md-4">
                {{ form.comp_date|as_crispy_field }}
                <div class="form-check mt-2">
                  <input type="checkbox" id="is-multi-day" class="form-check-input" name="is_multi_day">
                  <label for="is-multi-day" class="form-check-label">Multi-day Competition</label>
                </div>
              </div>
              <div class="col-md-4" id="end-date-container" style="display: none;">
                {{ form.comp_end_date|as_crispy_field }}
              </div>
              <div class="col-md-4">
                {{ form.start_time|as_crispy_field }}
              </div>
              <div class="col-md-12">
                {{ form.address|as_crispy_field }}
              </div>
              <div class="col-md-6">
                {{ form.city|as_crispy_field }}
              </div>
              <div class="col-md-4">
                {{ form.state|as_crispy_field }}
              </div>
              <div class="col-md-2">
                {{ form.zip_code|as_crispy_field }}
              </div>
              <div class="col-md-4">
                {{ form.federation|as_crispy_field }}
              </div>
              <div class="col-md-4">
                {{ form.signup_price|as_crispy_field }}
              </div>
              <div class="col-md-4">
                {{ form.capacity|as_crispy_field }}
              </div>
              <div class="col-md-6">
                {{ form.registration_deadline|as_crispy_field }}
              </div>
              <div class="col-md-6">
                {{ form.image|as_crispy_field }}
              </div>
              <div class="col-md-12">
                <p class="text-center mb-2"><b>Select Tags</b> <small>(Hold Ctrl to select multiple)</small></p>
                {{ form.tags|as_crispy_field }}
              </div>
              <div class="col-md-6">
                {{ form.allowed_divisions|as_crispy_field }}
              </div>
            
              <div class="col-md-6" id="weight-classes-container" style="display: none;">
                <p class="text-center mb-2"><b>Allowed Weight Classes</b></p>
                <div id="weight-classes-wrapper" class="d-flex flex-wrap justify-content-start">
                  {{ form.allowed_weight_classes|as_crispy_field }}
                </div>
              </div>
                 
              <div class="col-md-12">
                {{ form.description|as_crispy_field }}
              </div>
                <div class="col-md-6">
                    {{ form.facebook_url|as_crispy_field }}
                  </div>
                  <div class="col-md-6">
                    {{ form.instagram_url|as_crispy_field }}
                  </div>
                <div class="col-md-12">
  <div class="form-check mb-3">
    {{ form.provides_shirts|as_crispy_field }}
    <label class="form-check-label" for="{{ form.provides_shirts.id_for_label }}">

    </label>
  </div>

  <div id="tshirt-sizes-container" style="display: none;">
    <p class="mb-2"><b>Allowed T-shirt Sizes</b></p>
    {{ form.allowed_tshirt_sizes.errors }}
    {{ form.allowed_tshirt_sizes.label_tag }}
    {% for checkbox in form.allowed_tshirt_sizes %}
      <div class="form-check">
        {{ checkbox.tag }}
        <label class="form-check-label" for="{{ checkbox.id_for_label }}">
          {{ checkbox.choice_label }}
        </label>
      </div>
    {% endfor %}
  </div>
</div>
              <div class="col-md-12">
                <div class="form-check">
                    <input 
                        type="checkbox" 
                        class="form-check-input" 
                        id="{{ form.liability_waiver_accepted.id_for_label }}" 
                        name="{{ form.liability_waiver_accepted.name }}"
                        {% if form.initial.liability_waiver_accepted or form.data.liability_waiver_accepted %}checked{% endif %}
                    >
                    <label class="form-check-label" for="{{ form.liability_waiver_accepted.id_for_label }}">
                        I agree to the 
                        <a href="#" data-bs-toggle="modal" data-bs-target="#liabilityWaiverModal">liability waiver</a>
                    </label>
                    
                    <!-- Modal -->
<div class="modal fade" id="liabilityWaiverModal" tabindex="-1" aria-labelledby="liabilityWaiverLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="liabilityWaiverLabel">Liability Waiver and Release Form</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p><strong>WAIVER AND RELEASE OF LIABILITY</strong></p>
        <p>
          In consideration of being allowed to participate in the <strong>{{ competition.name }}</strong> ("the Competition"), I, the undersigned participant, acknowledge and agree to the following:
        </p>
        <ol>
          <li>
            <strong>Assumption of Risk:</strong> I understand that participating in the Competition involves inherent risks, including but not limited to, physical injury, property damage, and, in extreme cases, death. I voluntarily accept and assume all such risks.
          </li>
          <li>
            <strong>Release of Liability:</strong> I hereby release and discharge the organizer(s), sponsors, volunteers, and any associated entities from any and all claims, demands, damages, or causes of action, whether known or unknown, arising from or related to my participation in the Competition.
          </li>
          <li>
            <strong>Medical Authorization:</strong> I consent to receive medical treatment deemed necessary in the event of an injury or illness during the Competition. I understand that I am responsible for any medical expenses incurred.
          </li>
          <li>
            <strong>Compliance with Rules:</strong> I agree to follow all rules and instructions provided by the Competition organizers and acknowledge that failure to do so may result in disqualification or removal from the event.
          </li>
          <li>
            <strong>Media Release:</strong> I grant permission to the organizers to use my likeness, name, and image in any photographs, videos, or promotional materials without compensation.
          </li>
          <li>
            <strong>Indemnification:</strong> I agree to indemnify and hold harmless the organizers, sponsors, and their agents against any claims or damages arising out of my actions or participation in the Competition.
          </li>
          <li>
            <strong>Understanding of Agreement:</strong> I have read and fully understand this waiver. I voluntarily sign it, acknowledging that it is binding upon me, my heirs, and assigns.
          </li>
        </ol>
        <p>
          By participating in the Competition, I confirm that I am at least 18 years old or have obtained parental/guardian consent to participate in the event.
        </p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

                </div>
              </div>
            </div>

            <div class="d-grid mt-4">
              <button type="submit" class="btn btn-primary btn-lg" style="background-color: #333; border: none;">
                {{ is_update|yesno:"Update Competition,Create Competition" }}
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
  const providesShirtsCheckbox = document.getElementById('{{ form.provides_shirts.id_for_label }}');
  const tshirtSizesContainer = document.getElementById('tshirt-sizes-container');

  // Function to toggle the visibility of the T-shirt sizes container
  function toggleTshirtSizes() {
    if (providesShirtsCheckbox.checked) {
      tshirtSizesContainer.style.display = 'block';
    } else {
      tshirtSizesContainer.style.display = 'none';
    }
  }

  // Add event listener for changes in the checkbox
  providesShirtsCheckbox.addEventListener('change', toggleTshirtSizes);

  // Initialize the correct visibility state on page load
  toggleTshirtSizes();
});
</script>

    
<script>
document.addEventListener('DOMContentLoaded', function () {
  const multiDayCheckbox = document.getElementById('is-multi-day');
  const endDateContainer = document.getElementById('end-date-container');

  multiDayCheckbox.addEventListener('change', function () {
    if (this.checked) {
      endDateContainer.style.display = 'block';
    } else {
      endDateContainer.style.display = 'none';
    }
  });

  const federationSelect = document.getElementById('id_federation');
  const weightClassesContainer = document.getElementById('weight-classes-container');
  const weightClassesWrapper = document.getElementById('weight-classes-wrapper');

  if (!federationSelect || !weightClassesContainer || !weightClassesWrapper) return;

  federationSelect.addEventListener('change', function () {
    const federationId = this.value;

    if (federationId) {
      fetch(`/competitions/get_weight_classes/?federation_id=${federationId}`)
        .then((response) => response.json())
        .then((data) => {
          weightClassesWrapper.innerHTML = '';
          if (data.weight_classes && data.weight_classes.length > 0) {
            data.weight_classes.forEach((weightClass) => {
              const checkbox = document.createElement('input');
              checkbox.type = 'checkbox';
              checkbox.className = 'form-check-input me-2';
              checkbox.name = 'allowed_weight_classes';
              checkbox.value = weightClass.id;
              checkbox.id = `id_allowed_weight_classes_${weightClass.id}`;

              const label = document.createElement('label');
              label.className = 'form-check-label me-4';
              label.htmlFor = checkbox.id;
              label.textContent = weightClass.name;

              const wrapper = document.createElement('div');
              wrapper.className = 'form-check d-inline-block';
              wrapper.appendChild(checkbox);
              wrapper.appendChild(label);

              weightClassesWrapper.appendChild(wrapper);
            });
            weightClassesContainer.style.display = 'block';
          } else {
            weightClassesContainer.style.display = 'none';
          }
        });
    } else {
      weightClassesContainer.style.display = 'none';
    }
  });
});
tinymce.init({
    selector: '#id_description', // Target the description field by its ID
    height: 400,
    menubar: true,
    plugins: 'advlist autolink lists link image charmap preview anchor searchreplace visualblocks code fullscreen insertdatetime media table paste help wordcount',
    toolbar: 'undo redo | bold italic underline | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image | fullscreen',
    branding: false,
});
</script>
{% endblock %}
